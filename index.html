<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <meta name="description" content="Palettr — premium color palette generator for designers & devs" />
  <title>Palettr — Premium Redesign</title>

  <!-- Font Awesome kept -->
  <script src="https://kit.fontawesome.com/9603c04a31.js" crossorigin="anonymous"></script>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Small font fallback (optional) -->
  <style>
    @font-face {
      font-family: 'Chillax';
      src: local('Chillax'), local('Arial');
    }
    :root{
      --bg-dark: #071018;
      --panel-dark: rgba(255,255,255,0.03);
      --fg-dark: #e7f0f8;
      --accent: #20a7ff;
      --glass-shadow: 0 10px 30px rgba(2,6,23,0.6);
    }
    body.light {
      --bg-dark: #f6fbff; /* background variable reused for light */
      --panel-dark: rgba(2,6,23,0.03);
      --fg-dark: #07202a;
      --accent: #0f61a8;
      --glass-shadow: 0 10px 30px rgba(11,18,28,0.08);
    }
    html,body { height:100%; }
    body {
      font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: radial-gradient(600px 200px at 8% 12%, rgba(32,167,255,0.04), transparent 6%), radial-gradient(600px 200px at 92% 88%, rgba(142,191,231,0.02), transparent 12%), var(--bg-dark);
      color: var(--fg-dark);
      -webkit-font-smoothing:antialiased; -moz-osx-font-smoothing:grayscale;
      transition: background .28s ease, color .28s ease;
    }

    /* Glass card base */
    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));
      border: 1px solid rgba(255,255,255,0.04);
      backdrop-filter: blur(8px) saturate(.98);
      -webkit-backdrop-filter: blur(8px);
      box-shadow: var(--glass-shadow);
    }

    /* Brand heading */
    .brand-title { letter-spacing: 2px; font-weight:800; }

    /* Rounded tile swatches */
    .tile {
      border-radius: 12px;
      transition: transform .14s cubic-bezier(.2,.9,.3,1), box-shadow .18s ease;
      position: relative;
      overflow: visible;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
      min-height: 64px;
      min-width: 64px;
      user-select: none;
    }
    .tile:focus { outline: 3px solid rgba(32,167,255,0.16); outline-offset: 4px; }

    /* Hover/magnetic effect */
    .tile:hover { transform: translateY(-8px) scale(1.03); box-shadow: 0 14px 40px rgba(2,6,23,0.4); }

    /* overlay that reveals hex and actions */
    .tile-overlay {
      position:absolute;
      inset:0;
      display:flex;
      align-items:flex-end;
      justify-content:center;
      padding:10px;
      background: linear-gradient(180deg, rgba(0,0,0,0) 40%, rgba(0,0,0,0.28));
      opacity:0;
      transform: translateY(6px);
      transition: all .18s ease;
      border-radius:12px;
      pointer-events:none;
      color: white;
    }
    .tile:hover .tile-overlay, .tile:focus .tile-overlay {
      opacity:1;
      transform: translateY(0);
      pointer-events:auto;
    }

    /* small hex pill */
    .hex-pill {
      background: rgba(0,0,0,0.34);
      padding:6px 10px;
      border-radius:999px;
      font-weight:600;
      font-size:0.78rem;
      letter-spacing: .6px;
      box-shadow: 0 4px 16px rgba(2,6,23,0.4);
    }

    /* copy icon button */
    .copy-btn {
      background: rgba(255,255,255,0.06);
      border: 1px solid rgba(255,255,255,0.06);
      padding:6px 8px;
      border-radius:8px;
      margin-left:8px;
      display:inline-flex; align-items:center;
    }
    .copy-btn:active { transform: scale(.98); }

    /* palette card look */
    .palette-card {
      border-radius:14px;
      overflow:hidden;
      border: 1px solid rgba(255,255,255,0.04);
      display:flex;
      flex-direction:column;
      gap:12px;
      padding:12px;
    }

    /* toast */
    #toast {
      position: fixed; left:50%; transform:translateX(-50%); bottom:28px; z-index:60; display:none;
    }
    #toast .bubble {
      background: linear-gradient(90deg,var(--accent), rgba(20,110,160,0.95));
      color: white;
      padding: 10px 14px;
      border-radius: 999px;
      box-shadow: 0 12px 36px rgba(2,6,23,0.48);
      font-weight:700;
    }

    /* responsive tweaks */
    @media (max-width:880px){
      .left-rail { display:flex; gap:8px; align-items:center; justify-center: center; position:fixed; bottom:14px; left:50%; transform:translateX(-50%); z-index:60; background:transparent; }
    }
  </style>
</head>
<body class="antialiased">

  <!-- App container -->
  <div class="min-h-screen flex flex-col md:flex-row">

    <!-- Left rail (brand + nav) -->
    <aside class="w-full md:w-28 p-4 md:p-6 flex md:flex-col items-center gap-6 glass left-rail">
      <div class="flex items-center gap-3 md:flex-col">
        <img src="/assets/icon.png" alt="palettr" class="w-12 h-12 md:w-14 md:h-14 rounded-lg object-contain" />
        <div class="hidden md:block">
          <div class="brand-title text-lg">Palettr</div>
          <div class="text-xs text-[color:var(--fg-dark)]/70">Colors crafted</div>
        </div>
      </div>

      <nav class="flex md:flex-col gap-3 md:mt-6">
        <a class="nav-link p-3 rounded-lg glass flex items-center justify-center active" href="#hero" onclick="goPage(this)" aria-label="home"><i class="fa-solid fa-house"></i></a>
        <a class="nav-link p-3 rounded-lg glass flex items-center justify-center" href="#create-page" onclick="goPage(this)" aria-label="create"><i class="fa-solid fa-plus"></i></a>
        <a class="nav-link p-3 rounded-lg glass flex items-center justify-center" href="#random-page" onclick="goPage(this)" aria-label="quick"><i class="fa-solid fa-rotate"></i></a>
        <a class="nav-link p-3 rounded-lg glass flex items-center justify-center" href="#explore-page" onclick="goPage(this)" aria-label="explore"><i class="fa-solid fa-compass"></i></a>
      </nav>

      <div class="mt-auto">
        <button id="theme-toggle" class="w-10 h-10 rounded-md glass flex items-center justify-center" aria-label="toggle theme" onclick="toggleTheme(this)"><i class="fa-solid fa-moon"></i></button>
      </div>
    </aside>

    <!-- Main content -->
    <main class="flex-1 p-6 md:p-10 space-y-8">

      <!-- HERO -->
      <section id="hero" class="glass rounded-2xl p-8 md:p-12 flex flex-col md:flex-row gap-6 items-center justify-between relative overflow-hidden">
        <!-- Vanta anchor -->
        <div id="vanta-anchor" class="absolute inset-0 opacity-30 pointer-events-none"></div>

        <div class="z-10 max-w-xl">
          <h1 class="text-3xl md:text-4xl font-extrabold brand-title">Palettr</h1>
          <p class="mt-2 text-sm text-[color:var(--fg-dark)]/85 max-w-lg">Premium palettes for designers and devs. Rounded tiles, readable color suggestions, and exports — built to ship themes confidently.</p>

          <div class="mt-6 flex gap-3 flex-wrap">
            <button onclick="getQuickPallete(document.getElementById('generate-random-btn'))" class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-[color:var(--accent)] text-white hover:scale-[1.02]">
              <i class="fa-solid fa-rotate"></i> Quick palette
            </button>
            <a href="#create-page" class="inline-flex items-center gap-2 px-4 py-2 rounded-full glass">Create</a>
            <a href="#explore-page" class="inline-flex items-center gap-2 px-4 py-2 rounded-full glass">Explore</a>
          </div>
        </div>

        <!-- Hero sample (swatches) -->
        <div class="z-10 w-full md:w-96">
          <div class="palette-card h-36 p-3 flex items-center">
            <div id="quickPalette" class="flex gap-3 w-full h-full"></div>
          </div>
        </div>
      </section>

      <!-- QUICK GENERATE -->
      <section id="random-page" class="space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Generate a quick palette</h2>
          <div>
            <button id="generate-random-btn" class="inline-flex items-center gap-2 px-4 py-2 rounded-md bg-[color:var(--fg-dark)] text-[color:var(--bg-dark)]" onclick="getQuickPallete(this)">
              <i class="fa-solid fa-rotate"></i> Generate
            </button>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4 items-start">
          <div class="col-span-2 palette-card p-3 h-44">
            <div id="quickPaletteLarge" class="flex gap-3 w-full h-full items-stretch"></div>
          </div>

          <div class="glass p-4 rounded-xl h-44 flex flex-col justify-between">
            <p class="text-sm">Tip: tiles reveal hex on hover/tap. Copy a color with a click or keyboard (Enter).</p>
            <div class="flex gap-2">
              <button class="px-3 py-2 rounded-md bg-[color:var(--fg-dark)] text-[color:var(--bg-dark)]" onclick="downloadPaletteAsJSON()">Export JSON</button>
              <button class="px-3 py-2 rounded-md glass" onclick="downloadPaletteAsASE()">Export ASE</button>
            </div>
          </div>
        </div>
      </section>

      <!-- CREATE -->
      <section id="create-page" class="space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Create a custom palette</h2>
          <div class="flex items-center gap-3">
            <label class="text-sm">Model</label>
            <select id="model" class="rounded-md p-2 border border-[color:var(--panel-dark)]">
              <option value="default">Default</option>
              <option value="ui">UI</option>
            </select>
          </div>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div class="glass p-4 rounded-xl">
            <label class="text-sm block mb-2">Base color</label>
            <input id="base-color" type="color" value="#145d98" class="w-24 h-12 rounded-md border-none" />
            <p class="mt-3 text-sm text-[color:var(--fg-dark)]/80">Choose a base color — the model will produce a cohesive palette optimized for readability.</p>
            <div class="mt-4">
              <button id="dialog-btn" class="inline-flex items-center gap-2 px-4 py-2 rounded-md bg-[color:var(--fg-dark)] text-[color:var(--bg-dark)]" onclick="createPalette()">
                <i class="fa-solid fa-wand-magic-sparkles"></i> Create
              </button>
            </div>
          </div>

          <div class="col-span-2 palette-card p-3 rounded-xl h-44 flex items-center justify-center" id="createdPalette">
            <p class="text-sm text-[color:var(--fg-dark)]/80">You haven't created any palette yet</p>
          </div>
        </div>
      </section>

      <!-- EXPLORE -->
      <section id="explore-page" class="space-y-4">
        <div class="flex items-center justify-between">
          <h2 class="text-lg font-semibold">Explore palettes</h2>
          <div><button id="load-more-btn" class="px-4 py-2 rounded-md bg-[color:var(--fg-dark)] text-[color:var(--bg-dark)]" onclick="loadExpPalletes(this)">Generate set</button></div>
        </div>

        <div id="palletes-holder" class="grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4 max-h-96 overflow-y-auto"></div>
      </section>

      <!-- ABOUT -->
      <section id="about-page" class="pt-4 pb-10">
        <h2 class="text-lg font-semibold">About Palettr</h2>
        <p class="mt-2 text-sm text-[color:var(--fg-dark)]/85 max-w-2xl">Palettr helps designers and developers produce readable, production-ready color palettes fast. Tiles show color hex and allow quick copying/exporting for workflows.</p>
      </section>

    </main>
  </div>

  <!-- toast -->
  <div id="toast" aria-live="polite"><div class="bubble">Copied</div></div>

  <!-- vanta + three -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r121/three.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vanta@latest/dist/vanta.dots.min.js"></script>

  <!-- App JS -->
  <script>
  /* ======= DOM refs ======= */
  const palletesHolder = document.getElementById("palletes-holder");
  const modelSelect = document.getElementById("model");
  const baseColor = document.getElementById("base-color");
  const createdPalette = document.getElementById("createdPalette");
  const dialogBtn = document.getElementById("dialog-btn");
  const generateRandomBtn = document.getElementById("generate-random-btn");
  const quickPalette = document.getElementById("quickPalette");
  const quickPaletteLarge = document.getElementById("quickPaletteLarge");
  const loadMoreBtn = document.getElementById("load-more-btn");
  const toast = document.getElementById("toast");

  const hexvalues = "0123456789ABCDEF".split("");

  /* ======= color helpers ======= */
  function hexArrFromStr(h){
    const s = h.replace("#","");
    return [ parseInt(s.slice(0,2),16), parseInt(s.slice(2,4),16), parseInt(s.slice(4,6),16) ];
  }
  function rgbFromArr(a){
    return "#" + a.map(v => {
      const hi = Math.floor(v/16), lo = v - hi*16;
      return hexvalues[hi]+hexvalues[lo];
    }).join("");
  }

  /* ======= small ui ======= */
  function showToast(msg="Copied"){
    toast.querySelector(".bubble").textContent = msg;
    toast.style.display = "block";
    toast.style.opacity = "1";
    setTimeout(()=>{ toast.style.opacity = "0"; setTimeout(()=> toast.style.display="none",220); },1400);
  }

  function copyToClipboard(txt){
    navigator.clipboard.writeText(txt).then(()=> showToast("Copied: " + txt)).catch(()=> showToast("Could not copy"));
  }

  /* ======= tile factory ======= */
  function makeTile(hexColor){
    const btn = document.createElement("button");
    btn.className = "tile flex-1";
    btn.style.background = hexColor;
    btn.style.minWidth = "64px";
    btn.setAttribute("aria-label", "Color " + hexColor);
    btn.setAttribute("tabindex","0");

    // overlay
    const overlay = document.createElement("div");
    overlay.className = "tile-overlay";
    overlay.innerHTML = `<div class="hex-pill">${hexColor.toUpperCase()}</div>
                         <button class="copy-btn ml-2" title="Copy hex" aria-label="Copy hex"><i class="fa-regular fa-copy"></i></button>`;
    overlay.querySelector(".copy-btn").addEventListener("click", (e)=>{
      e.stopPropagation();
      copyToClipboard(hexColor.toUpperCase());
    });

    // main click copies
    btn.addEventListener("click", ()=> { copyToClipboard(hexColor.toUpperCase()); btn.animate([{transform:"scale(1.03)"},{transform:"scale(1)"}],{duration:160}); });

    // keyboard copy on Enter
    btn.addEventListener("keydown", (e)=> { if(e.key === "Enter") btn.click(); });

    btn.appendChild(overlay);
    return btn;
  }

  /* ======= render palette into container ======= */
  function renderPalette(container, arr){
    container.innerHTML = "";
    arr.forEach(a => {
      const hex = rgbFromArr(a);
      const tile = makeTile(hex);
      tile.style.flex = "1 1 0%";
      container.appendChild(tile);
    });
  }

  /* ======= explore card generator (rounded tiles row + meta) ======= */
  function createExploreCard(arr){
    const wrapper = document.createElement("div");
    wrapper.className = "palette-card glass p-3 flex flex-col gap-3";

    const strip = document.createElement("div");
    strip.className = "flex gap-3";
    arr.forEach(a => {
      const hex = rgbFromArr(a);
      const t = makeTile(hex);
      t.style.flex = "1 1 0%";
      t.style.height = "64px";
      strip.appendChild(t);
    });

    const bottom = document.createElement("div");
    bottom.className = "flex items-center justify-between";
    const meta = document.createElement("span");
    meta.className = "text-xs text-[color:var(--fg-dark)]/70";
    meta.textContent = "Model: " + (Math.random() > .5 ? "ui" : "default");
    const actions = document.createElement("div");
    actions.className = "flex gap-2";
    const copyBtn = document.createElement("button");
    copyBtn.className = "px-3 py-1 rounded-md glass text-xs";
    copyBtn.innerHTML = '<i class="fa-regular fa-copy"></i>';
    copyBtn.title = "Copy palette";
    copyBtn.addEventListener("click", ()=> copyToClipboard(arr.map(a=>rgbFromArr(a)).join(", ")));
    const dlBtn = document.createElement("button");
    dlBtn.className = "px-3 py-1 rounded-md bg-[color:var(--fg-dark)] text-[color:var(--bg-dark)] text-xs";
    dlBtn.innerHTML = '<i class="fa-solid fa-download"></i>';
    dlBtn.title = "Download JSON";
    dlBtn.addEventListener("click", ()=> {
      const data = JSON.stringify(arr.map(a=>rgbFromArr(a)), null, 2);
      const blob = new Blob([data], {type: "application/json"});
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url; a.download = `palettr-${Date.now()}.json`; a.click();
      URL.revokeObjectURL(url);
    });

    actions.appendChild(copyBtn);
    actions.appendChild(dlBtn);
    bottom.appendChild(meta);
    bottom.appendChild(actions);

    wrapper.appendChild(strip);
    wrapper.appendChild(bottom);

    return wrapper;
  }

  /* ======= network & API helpers ======= */
  function randomModel(){ return Math.random() > .5 ? "ui" : "default"; }
  async function postColormind(body){
    const res = await fetch("https://colormind-proxy.onrender.com/colormind", {
      method:"POST", headers: { "Content-Type":"application/json" }, body: JSON.stringify(body)
    });
    return res.json();
  }

  async function getQuickPallete(btn){
    try {
      btn.setAttribute("disabled", true);
      btn.querySelector("i")?.classList?.add("fa-spin");
      const data = await postColormind({ model: randomModel(), input: ["N","N","N","N","N"] });
      if(data && data.result) {
        renderPalette(quickPalette, data.result);
        renderPalette(quickPaletteLarge, data.result);
      } else showToast("No result");
    } catch(e){ console.warn(e); showToast("Network error"); }
    finally { btn.removeAttribute("disabled"); btn.querySelector("i")?.classList?.remove("fa-spin"); }
  }

  async function createPalette(){
    try {
      dialogBtn.setAttribute("disabled", true);
      dialogBtn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
      const model = modelSelect.value;
      const data = await postColormind({ model, input: [ hexArrFromStr(baseColor.value), "N","N","N","N" ] });
      if(data && data.result) {
        renderPalette(createdPalette, data.result);
        showToast("Palette created");
      } else showToast("No result");
    } catch(e){ console.warn(e); showToast("Create failed"); }
    finally { dialogBtn.removeAttribute("disabled"); dialogBtn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Create'; }
  }

  async function loadExpPalletes(btn){
    try {
      btn.setAttribute("disabled", true);
      btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i>';
      const sets = [];
      for(let i=0;i<6;i++){
        try { const data = await postColormind({ model: randomModel(), input:["N","N","N","N","N"] }); if(data && data.result) sets.push(data.result); } catch(e){}
      }
      palletesHolder.innerHTML = "";
      sets.forEach(s => palletesHolder.appendChild(createExploreCard(s)));
      btn.textContent = "Generate set";
    } finally { btn.removeAttribute("disabled"); }
  }

  // export helpers
  function downloadPaletteAsJSON(){
    const sw = Array.from(quickPaletteLarge.children).map(el => el.querySelector(".hex-pill")?.textContent || el.textContent);
    const data = JSON.stringify(sw, null, 2);
    const blob = new Blob([data], {type:"application/json"});
    const a = document.createElement("a"); a.href = URL.createObjectURL(blob); a.download = `palettr-${Date.now()}.json`; a.click();
    showToast("Exported JSON");
  }
  function downloadPaletteAsASE(){
    // ASE binary is complex; provide JSON fallback and note it
    downloadPaletteAsJSON();
    showToast("ASE export fallback (JSON)");
  }

  /* ======= color conversion helper (string -> [r,g,b]) ======= */
  function hexArrFromStr(h){
    const s = h.replace("#","");
    return [ parseInt(s.slice(0,2),16), parseInt(s.slice(2,4),16), parseInt(s.slice(4,6),16) ];
  }
  function rgbFromArr(a){
    return "#" + a.map(v => {
      const hi = Math.floor(v/16), lo = v - hi*16;
      return hexvalues[hi]+hexvalues[lo];
    }).join("");
  }

  /* ======= Vanta init (background) ======= */
  if(window.VANTA && VANTA.DOTS){
    VANTA.DOTS({
      el: "#vanta-anchor", mouseControls:true, touchControls:true, gyroControls:false,
      minHeight:200.0, minWidth:200.0, scale:1.0, scaleMobile:1.0, color: 0x20a7ff, color2: 0x80d0ff, showLines:false
    });
  } else {
    setTimeout(()=>{ if(window.VANTA && VANTA.DOTS) VANTA.DOTS({ el:"#vanta-anchor", mouseControls:true, touchControls:true, color:0x20a7ff, color2:0x80d0ff, showLines:false }); }, 600);
  }

  /* ======= init calls ======= */
  getQuickPallete(generateRandomBtn);
  loadExpPalletes(loadMoreBtn);

  /* ======= theme toggle (exposed) ======= */
  function toggleTheme(btn){
    document.body.classList.toggle("light");
    const i = btn.querySelector("i"); if(!i) return;
    i.classList.toggle("fa-moon"); i.classList.toggle("fa-sun");
  }
  window.toggleTheme = toggleTheme;

  /* ======= small utilities exposed for inline buttons ======= */
  window.getQuickPallete = getQuickPallete;
  window.createPalette = createPalette;
  window.loadExpPalletes = loadExpPalletes;
  window.downloadPaletteAsJSON = downloadPaletteAsJSON;
  window.downloadPaletteAsASE = downloadPaletteAsASE;

  /* ======= goPage for nav anchors ======= */
  window.goPage = function(el){
    document.querySelectorAll(".nav-link").forEach(a=>a.classList.remove("active"));
    el.classList.add("active");
    const href = el.getAttribute("href");
    if(href && href.startsWith("#")) document.querySelector(href)?.scrollIntoView({behavior:"smooth", block:"start"});
  };

  // keyboard escape hides toast quickly
  document.addEventListener("keydown", (e)=>{ if(e.key === "Escape") toast.style.display="none"; });

  </script>
</body>
</html>
