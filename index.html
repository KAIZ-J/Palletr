<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Palettr — Premium Rebuild</title>
  <meta name="description" content="Palettr — premium color palettes (rebuild)">

  <!-- Font Awesome -->
  <script src="https://kit.fontawesome.com/9603c04a31.js" crossorigin="anonymous"></script>

  <!-- Tailwind CDN -->
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    /* ----------------- Theme tokens (muted, professional) ----------------- */
   body { overflow-x:hidden; transition: background 0.26s, color 0.26s; }
    :root{
      --bg: #0a0a0a;
      --panel: rgba(255,255,255,0.02);
      --fg: #e5e5e5;
      --muted: rgba(255,255,255,0.05);
      --accent: #4f7388;
      --glass-shadow: 0 12px 36px rgba(0,0,0,0.5);
      --control-bg: rgba(255,255,255,0.03);
      --pill: rgba(255,255,255,0.02);
    }
    body.light{
      --bg:#fdfdfd;
      --panel: rgba(0,0,0,0.03);
      --fg:#0a0a0a;
      --muted: rgba(0,0,0,0.05);
      --accent:#4f7388;
      --glass-shadow:0 10px 28px rgba(0,0,0,0.06);
      --control-bg: rgba(0,0,0,0.03);
      --pill: rgba(0,0,0,0.02);
    } 

    html,body { height:100%; }
    body{
      margin:0;
      min-height:100vh;
      background:
        radial-gradient(900px 300px at 8% 12%, rgba(106,160,191,0.02), transparent 6%),
        var(--bg);
      color:var(--fg);
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto, Arial;
      transition: background .26s ease, color .26s ease;
    }

    /* Glass card */
    .glass {
      background: linear-gradient(180deg, rgba(255,255,255,0.01), rgba(255,255,255,0.005));
      border: 1px solid var(--muted);
      border-radius: 12px;
      backdrop-filter: blur(6px) saturate(.98);
      -webkit-backdrop-filter: blur(6px);
      box-shadow: var(--glass-shadow);
    }

    /* ---------- fixed left rail ---------- */
    aside.left-rail {
      position: fixed;
      left: 20px;
      top: 22px;
      bottom: 22px;
      width: 84px;
      display:flex;
      flex-direction:column;
      align-items:center;
      gap:14px;
      padding:14px;
      z-index:70;
    }
    @media(min-width:1024px){
      aside.left-rail { width:240px; align-items:flex-start; padding:18px; border-radius:14px; }
      aside.left-rail .label { display:inline-block; margin-left:10px; font-weight:700; color:var(--fg); }
    }
    @media(max-width:1023px){
      aside.left-rail { display:none; } /* replace with mobile nav */
    }

    .nav-item { width:100%; display:flex; align-items:center; gap:10px; padding:8px 10px; border-radius:10px; color:var(--fg); background:transparent; transition: all .14s ease; text-align:left; }
    .nav-item:hover { background: var(--pill); }
    .nav-item.active { background: linear-gradient(90deg,var(--accent), rgba(80,130,150,0.14)); color:white; box-shadow: 0 8px 30px rgba(6,18,28,0.28); }

    .icon-wrap { width:40px; height:40px; display:inline-flex; align-items:center; justify-content:center; border-radius:9px; background:var(--control-bg); }

    /* -------- mobile bottom nav -------- */
    .mobile-bottom { display:none; }
    @media(max-width:1023px){
      .mobile-bottom { display:flex; position:fixed; bottom:14px; left:50%; transform:translateX(-50%); gap:8px; padding:8px 12px; border-radius:999px; z-index:80; background:var(--panel); backdrop-filter: blur(6px); box-shadow: 0 10px 30px rgba(6,12,18,0.4); }
    }

    /* ----- content spacing for fixed rail ----- */
    main.content { margin-left: 20px; padding:18px; }
    @media(min-width:1024px){ main.content { margin-left: 280px; padding:28px; } }

    /* ---------- showcase (stable panels) ---------- */
    .showcase-wrap { overflow:hidden; border-radius:12px; }
    .showcase-track { display:flex; gap:12px; align-items:stretch; height:80px; position:relative; }
    .panel { display:flex; gap:12px; min-width:100%; align-items:stretch; transition: transform .6s cubic-bezier(.22,.9,.3,1), opacity .4s ease; }
    .swatch { flex:1 1 0%; border-radius:10px; display:flex; align-items:center; justify-content:center; font-weight:700; color:rgba(255,255,255,0.88); min-height:72px; }

    /* ---------- explore cards ---------- */
    .palette-card { border-radius:12px; padding:12px; display:flex; flex-direction:column; gap:10px; border:1px solid var(--muted); background: linear-gradient(180deg, rgba(255,255,255,0.007), rgba(255,255,255,0.003)); }
    .card-swatches { display:flex; gap:8px; align-items:stretch; }

    /* tile overlay (explore) */
    .tile { position:relative; border-radius:10px; min-height:60px; display:flex; align-items:center; justify-content:center; overflow:visible; }
   
    /* ---- compact control styles ---- */
    .btn-compact { padding:8px 10px; border-radius:8px; font-weight:700; font-size:0.9rem; display:inline-flex; gap:8px; align-items:center; justify-content:center; white-space:nowrap; }
    .btn-compact:disabled { opacity:.6; }

    /* toast */
    #toast { position:fixed; left:50%; transform:translateX(-50%); bottom:22px; z-index:90; display:none; }
    #toast .bubble { padding:8px 12px; border-radius:999px; background:linear-gradient(90deg,var(--accent), rgba(50,90,110,0.95)); color:white; font-weight:700; box-shadow: 0 10px 30px rgba(6,12,18,0.45); }

    /* keep consistent card heights */
    .equal-h { display:flex; flex-direction:column; }
    .equal-h > .body { flex:1; display:flex; align-items:center; justify-content:center; gap:8px; }
    .equal-h .footer { display:flex; align-items:center; justify-content:space-between; gap:8px; margin-top:8px; }

    /* ensure no button overflow on small screens */
    .no-wrap { white-space:nowrap; overflow:hidden; text-overflow:ellipsis; }
  </style>
</head>
<body class="antialiased">

  <!-- Left rail (desktop; fixed). On mobile it's hidden -->
  <aside class="left-rail glass" aria-hidden="false">
    <img src="/assets/icon.png" alt="palettr" class="w-12 h-12 rounded-lg object-contain" />
    <nav class="mt-3 w-full space-y-2" aria-label="Main">
      <button class="nav-item active" data-href="#hero" onclick="navClick(this)"><span class="icon-wrap"><i class="fa-solid fa-house"></i></span><span class="label">Home</span></button>
      <button class="nav-item" data-href="#create-page" onclick="navClick(this)"><span class="icon-wrap"><i class="fa-solid fa-plus"></i></span><span class="label">Create</span></button>
      <button class="nav-item" data-href="#random-page" onclick="navClick(this)"><span class="icon-wrap"><i class="fa-solid fa-rotate"></i></span><span class="label">Quick</span></button>
      <button class="nav-item" data-href="#explore-page" onclick="navClick(this)"><span class="icon-wrap"><i class="fa-solid fa-compass"></i></span><span class="label">Explore</span></button>
    </nav>
    <div class="mt-auto w-full">
      <button class="nav-item" onclick="toggleTheme(this)"><span class="icon-wrap"><i class="fa-solid fa-moon"></i></span><span class="label">Theme</span></button>
    </div>
  </aside>

  <!-- Mobile bottom navigation (icons only) -->
  <div class="mobile-bottom glass hidden" role="navigation" aria-label="Mobile">
    <button aria-label="home" onclick="mobileNav('#hero')"><i class="fa-solid fa-house"></i></button>
    <button aria-label="create" onclick="mobileNav('#create-page')"><i class="fa-solid fa-plus"></i></button>
    <button aria-label="quick" onclick="mobileNav('#random-page')"><i class="fa-solid fa-rotate"></i></button>
    <button aria-label="explore" onclick="mobileNav('#explore-page')"><i class="fa-solid fa-compass"></i></button>
    <button aria-label="theme" onclick="toggleTheme(this)"><i class="fa-solid fa-moon"></i></button>
  </div>

  <!-- Main content -->
  <main class="content min-h-screen">
    <!-- HERO -->
    <section id="hero" class="glass p-5 md:p-8 rounded-xl mb-6">
      <div class="md:flex md:items-center md:gap-8">
        <div class="flex-1">
          <h1 class="text-2xl md:text-3xl font-extrabold">Palettr</h1>
          <p class="mt-2 text-sm text-[color:var(--fg)]/86 max-w-xl">Professional, muted palettes optimized for readability. The showcase rotates every 5 seconds — no clicks required.</p>

          <div class="mt-4 flex flex-wrap gap-3">
            <button class="btn-compact bg-[color:var(--accent)] text-white no-wrap" onclick="getQuickPallete(document.getElementById('generate-random-btn'))"><i class="fa-solid fa-rotate"></i> Quick</button>
            <button class="btn-compact glass no-wrap" onclick="scrollTo('#create-page')">Create</button>
            <button class="btn-compact glass no-wrap" onclick="scrollTo('#explore-page')">Explore</button>
          </div>
        </div>

        <!-- Showcase -->
        <div class="w-full md:w-96 mt-4 md:mt-0">
          <div class="showcase-wrap glass p-3">
            <div id="showcase-track" class="showcase-track"></div>
          </div>
        </div>
      </div>
    </section>

    <!-- CREATE -->
    <section id="create-page" class="mb-6">
      <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
        <div class="glass p-6 md:p-8 rounded-xl space-y-4">
  <!-- Base color -->
  <div>
    <label class="block text-xs text-[color:var(--fg)]/70 mb-1">Base color</label>
    <input 
      id="base-color" 
      type="color" 
      value="#2b6b7a" 
      class="w-28 h-12 rounded-lg border border-[color:var(--muted)] p-1 cursor-pointer transition-all duration-200 hover:scale-105 focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)]"
    />
  </div>

  <!-- Model select -->
  <div>
    <label class="block text-xs text-[color:var(--fg)]/70 mb-1">Model</label>
    <div class="relative w-full">
      <select id="model" 
        class="appearance-none w-full p-2 pr-10 rounded-lg border border-[color:var(--muted)] bg-[color:var(--panel)] text-[color:var(--fg)] focus:outline-none focus:ring-2 focus:ring-[color:var(--accent)] transition-colors duration-200 hover:border-[color:var(--accent)] cursor-pointer"
      >
        <option value="default">Default</option>
        <option value="ui">UI</option>
      </select>
      <div class="pointer-events-none absolute inset-y-0 right-3 flex items-center">
        <i class="fa-solid fa-chevron-down text-[color:var(--fg)]/60"></i>
      </div>
    </div>
  </div>

  <!-- Create button -->
  <div>
    <button 
      id="dialog-btn" 
      class="w-full md:w-auto btn-compact bg-[color:var(--fg)] text-[color:var(--bg)] hover:bg-[color:var(--accent)] hover:text-white transition-all duration-200 rounded-lg px-4 py-2 font-semibold shadow-md hover:shadow-lg"
      onclick="createPalette()"
    >
      <i class="fa-solid fa-wand-magic-sparkles mr-2"></i> Create palette
    </button>
  </div>
</div>


        <div id="createdPalette" class="md:col-span-2 palette-card equal-h">
          <div class="body">
            <p class="text-sm text-[color:var(--fg)]/80">No created palette yet. Create one using the form.</p>
          </div>
          <div class="footer">
            <div class="text-xs text-[color:var(--fg)]/70">Generated palettes are temporary in this demo.</div>
            <div class="flex gap-2">
              <button class="btn-compact glass" onclick="downloadPaletteAsJSON()">Export JSON</button>
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- QUICK -->
    <section id="random-page" class="mb-6">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold">Quick — Random palettes</h2>
        <div>
          <button id="generate-random-btn" class="btn-compact bg-[color:var(--fg)] text-[color:var(--bg)] no-wrap" onclick="getQuickPallete(this)"><i class="fa-solid fa-rotate"></i> Generate</button>
        </div>
      </div>

      <div class="mt-4 grid grid-cols-1 md:grid-cols-2 gap-4">
        <div class="palette-card p-3">
          <div id="quickLarge" class="flex gap-3 w-full h-36 items-stretch"></div>
        </div>

        <div class="glass p-4 rounded-xl">
          <p class="text-sm">Preview fast palettes here. Click a tile to copy the hex; export if you like a result.</p>
          <div class="mt-4 flex gap-2">
            <button class="btn-compact glass" onclick="downloadPaletteAsJSON()">Export JSON</button>
            <button class="btn-compact glass" onclick="downloadPaletteAsASE()">ASE</button>
          </div>
        </div>
      </div>
    </section>

    <!-- EXPLORE -->
    <section id="explore-page" class="mb-12">
      <div class="flex items-center justify-between">
        <h2 class="text-lg font-semibold">Explore</h2>
        <div class="flex gap-2">
          <button id="load-more-btn" class="btn-compact bg-[color:var(--fg)] text-[color:var(--bg)] no-wrap" onclick="loadExpPalletes(this)">Generate set</button>
          <button class="btn-compact glass no-wrap" onclick="shuffleExplore()">Shuffle</button>
        </div>
      </div>

      <div id="palletes-holder" class="mt-4 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4"></div>
    </section>

    <!-- ABOUT -->
    <section class="mb-12">
      <h3 class="text-base font-semibold">About</h3>
      <p class="mt-2 text-sm text-[color:var(--fg)]/80 max-w-2xl">This rebuild focuses on stability, a premium muted palette, and a working infinite showcase. I kept the default 5-color palettes and Tailwind CDN as requested.</p>
    </section>
  </main>

  <!-- Toast -->
  <div id="toast" aria-live="polite"><div class="bubble">Copied</div></div>

  <!-- Script: keep everything simple and robust -->
  <script>
  /* ======= DOM refs ======= */
  const showcaseTrack = document.getElementById('showcase-track');
  const quickLarge = document.getElementById('quickLarge');
  const createdPalette = document.getElementById('createdPalette');
  const palletesHolder = document.getElementById('palletes-holder');
  const generateRandomBtn = document.getElementById('generate-random-btn');
  const loadMoreBtn = document.getElementById('load-more-btn');
  const dialogBtn = document.getElementById('dialog-btn');
  const toast = document.getElementById('toast');

  const hexvalues = "0123456789ABCDEF".split("");

  /* ======= util: hex <-> rgb helpers (kept logical) ======= */
  function hexArrFromStr(h){
    const s = h.replace('#','');
    return [ parseInt(s.slice(0,2),16), parseInt(s.slice(2,4),16), parseInt(s.slice(4,6),16) ];
  }
  function rgbFromArr(a){
    return '#' + a.map(v => {
      const hi = Math.floor(v/16), lo = v - hi*16;
      return hexvalues[hi] + hexvalues[lo];
    }).join('');
  }

  /* ======= toast ======= */
  function showToast(msg='Copied'){
    toast.querySelector('.bubble').textContent = msg;
    toast.style.display = 'block';
    toast.style.opacity = '1';
    setTimeout(()=>{ toast.style.opacity = '0'; setTimeout(()=> toast.style.display='none',220); },1400);
  }

  /* ======= copy ======= */
  function copyToClipboard(txt){
    navigator.clipboard.writeText(txt).then(()=> showToast(txt)).catch(()=> showToast('Could not copy'));
  }

  /* ======= tile factory ======= */
  function makeTile(hexColor, height='64px'){
  const btn = document.createElement('button');
  btn.className = 'tile relative group';
  btn.style.background = hexColor;
  btn.style.height = height;
  btn.style.flex = '1 1 0%';
  btn.setAttribute('aria-label', 'Color ' + hexColor);
  btn.tabIndex = 0;

  // Tooltip
  const tooltip = document.createElement('span');
  tooltip.className = 'absolute bottom-full left-1/2 transform -translate-x-1/2 mb-2 px-2 py-1 bg-[color:var(--fg)] text-[color:var(--bg)] text-xs rounded opacity-0 transition-opacity duration-300 pointer-events-none z-50';
  tooltip.textContent = hexColor.toUpperCase();
  btn.appendChild(tooltip);

  // Hover for desktop
  btn.addEventListener('mouseenter', ()=> tooltip.style.opacity = '1');
  btn.addEventListener('mouseleave', ()=> tooltip.style.opacity = '0');

  // Tap for mobile
  btn.addEventListener('click', (e)=>{
    e.stopPropagation();
    const isVisible = tooltip.style.opacity === '1';
    tooltip.style.opacity = isVisible ? '0' : '1';
    copyToClipboard(hexColor.toUpperCase());
    btn.animate([{transform:'scale(1.05)'},{transform:'scale(1)'}], {duration:120});
  });

  // Close tooltip if click outside
  document.addEventListener('click', ()=> tooltip.style.opacity = '0');

  btn.addEventListener('keydown', (e)=> { if(e.key === 'Enter') btn.click(); });

  return btn;
}



  /* ======= fetch helper ======= */
  async function fetchPalette(model=null, base=null){
    try {
      const body = model ? { model, input: base ? [ hexArrFromStr(base), 'N','N','N','N' ] : ["N","N","N","N","N"] }
                         : { model: (Math.random()>0.5 ? 'ui' : 'default'), input: ["N","N","N","N","N"] };
      const resp = await fetch('https://colormind-proxy.onrender.com/colormind', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(body)
      });
      const data = await resp.json();
      return data?.result || null;
    } catch(err){
      console.warn('fetch fail', err);
      return null;
    }
  }
function pushPanel(arr){
  const panel = document.createElement('div');
  panel.className = 'panel';
  panel.style.position = 'absolute';
  panel.style.width = '100%';
  panel.style.top = '0';
  panel.style.left = '0';
  panel.style.display = 'flex';
  panel.style.gap = '12px';
  panel.style.opacity = '0';

  // create swatches
  arr.forEach((a, i) => {
    const s = document.createElement('div');
    s.className = 'swatch';
    s.style.background = rgbFromArr(a);
    s.style.opacity = '0';
    s.style.transform = 'translateY(20px)';
    panel.appendChild(s);
  });

  showcaseTrack.appendChild(panel);

  // Animate old panels up & fade out
  Array.from(showcaseTrack.children).forEach(oldPanel => {
    if(oldPanel !== panel){
      Array.from(oldPanel.children).forEach((s, idx) => {
        setTimeout(() => {
          s.style.transition = 'transform 0.8s ease, opacity 0.8s ease';
          s.style.transform = 'translateY(-30px)';
          s.style.opacity = '0';
        }, idx * 100); // stagger old swatches
      });

      // remove old panel after animation
      setTimeout(() => oldPanel.remove(), 1000);
    }
  });

  // Animate new panel in from bottom
  Array.from(panel.children).forEach((s, idx) => {
    setTimeout(() => {
      s.style.transition = 'transform 0.8s ease, opacity 0.8s ease';
      s.style.transform = 'translateY(0)';
      s.style.opacity = '1';
    }, idx * 150); // stagger new swatches
  });

  panel.style.opacity = '1';
}
  
 
 
 
 
  /* ======= Showcase: stable infinite loop implementation ======= */
const SHOWCASE_INTERVAL = 4000;  
let showcaseIntervalId = null; 

async function startShowcaseLoop(){
  if(showcaseIntervalId) clearInterval(showcaseIntervalId);

  async function pushNext(){
    const next = await fetchPalette();
    if(next) pushPanel(next);
  }

  pushNext(); // first panel
  showcaseIntervalId = setInterval(pushNext, SHOWCASE_INTERVAL);
}


  /* ======= Quick / Create / Explore logic ======= */
  async function getQuickPallete(btn){
    btn.setAttribute('disabled', true);
    btn.querySelector('i')?.classList?.add('fa-spin');
    try {
      const p = await fetchPalette();
      if(p){
        quickLarge.innerHTML = '';
        p.forEach(a => { quickLarge.appendChild(makeTile(rgbFromArr(a), '100%')); });
        pushPanel(p); // keep showcase in sync visually
      } else showToast('No result');
    } catch(e){ showToast('Network error'); }
    finally { btn.removeAttribute('disabled'); btn.querySelector('i')?.classList?.remove('fa-spin'); }
  }

  async function createPalette(){
    dialogBtn.setAttribute('disabled', true);
    dialogBtn.textContent = 'Creating...';
    try {
      const model = document.getElementById('model').value;
      const base = document.getElementById('base-color').value;
      const p = await fetchPalette(model, base);
      if(p){
        const body = createdPalette.querySelector('.body') || createdPalette;
        body.innerHTML = '';
        const strip = document.createElement('div'); strip.className = 'flex gap-3 w-full';
        p.forEach(a => { const t = makeTile(rgbFromArr(a), '72px'); strip.appendChild(t); });
        body.appendChild(strip);
        showToast('Palette created');
      } else showToast('No result');
    } catch(e){ showToast('Create failed'); }
    finally { dialogBtn.removeAttribute('disabled'); dialogBtn.innerHTML = '<i class="fa-solid fa-wand-magic-sparkles"></i> Create palette'; }
  }

  async function loadExpPalletes(btn){
    btn.setAttribute('disabled', true);
    btn.textContent = 'Loading...';
    try {
      const sets = [];
      for(let i=0;i<8;i++){
        const s = await fetchPalette();
        if(s) sets.push(s);
        await new Promise(r => setTimeout(r, 90));
      }
      palletesHolder.innerHTML = '';
      sets.forEach(s => {
        const card = document.createElement('div'); card.className = 'palette-card';
        const sw = document.createElement('div'); sw.className = 'card-swatches'; sw.style.display='flex';
        s.forEach(a => { const t = makeTile(rgbFromArr(a), '64px'); t.style.flex='1 1 0%'; sw.appendChild(t); });
        const meta = document.createElement('div'); meta.className = 'flex items-center justify-between mt-2';
        const tag = document.createElement('div'); tag.className = 'text-xs text-[color:var(--fg)]/70'; tag.textContent = 'Curated';
        const actions = document.createElement('div'); actions.className = 'flex gap-2';
        const copyBtn = document.createElement('button'); copyBtn.className = 'btn-compact glass text-xs'; copyBtn.innerHTML = '<i class="fa-regular fa-copy"></i>';
        copyBtn.addEventListener('click', ()=> copyToClipboard(s.map(a => rgbFromArr(a)).join(', ')));
        const remixBtn = document.createElement('button'); remixBtn.className = 'btn-compact bg-[color:var(--fg)] text-[color:var(--bg)] text-xs'; remixBtn.textContent = 'Remix';
        remixBtn.addEventListener('click', async ()=> {
          remixBtn.setAttribute('disabled', true);
          remixBtn.textContent = 'Remixing...';
          const newp = await fetchPalette();
          if(newp){ sw.innerHTML=''; newp.forEach(a => { const t = makeTile(rgbFromArr(a), '64px'); t.style.flex='1 1 0%'; sw.appendChild(t); }); showToast('Remixed'); }
          remixBtn.removeAttribute('disabled'); remixBtn.textContent = 'Remix';
        });
        actions.appendChild(copyBtn); actions.appendChild(remixBtn);
        meta.appendChild(tag); meta.appendChild(actions);
        card.appendChild(sw); card.appendChild(meta);
        palletesHolder.appendChild(card);
      });
    } catch(e){ showToast('Load failed'); }
    finally { btn.removeAttribute('disabled'); btn.textContent = 'Generate set'; }
  }

  function shuffleExplore(){
    const cards = Array.from(palletesHolder.children);
    for(let i=cards.length-1;i>0;i--){
      const j = Math.floor(Math.random()*(i+1));
      palletesHolder.appendChild(cards[j]);
      cards.splice(j,1);
    }
    showToast('Shuffled');
  }

  /* ======= exports ======= */
  function downloadPaletteAsJSON(){
    const sw = Array.from(quickLarge.children).map(c => c.querySelector('.copy-pill')?.textContent || '');
    const blob = new Blob([JSON.stringify(sw, null, 2)], { type: 'application/json' });
    const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = `palettr-${Date.now()}.json`; a.click();
    showToast('Exported JSON');
  }
  function downloadPaletteAsASE(){ downloadPaletteAsJSON(); showToast('ASE fallback'); }

  /* ======= nav helpers ======= */
  function navClick(btn){
    document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
    btn.classList.add('active');
    const target = btn.dataset.href;
    if(target) document.querySelector(target)?.scrollIntoView({ behavior: 'smooth', block: 'start' });
  }
  function mobileNav(target){ document.querySelector(target)?.scrollIntoView({ behavior:'smooth', block: 'start' }); }

  function scrollTo(id){ document.querySelector(id)?.scrollIntoView({ behavior:'smooth' }); }

  function toggleTheme(btn){
    document.body.classList.toggle('light');
    const i = btn.querySelector('i'); if(i) i.classList.toggle('fa-moon'), i.classList.toggle('fa-sun');
  }

  /* ======= init ======= */
 (async function init(){
  try {
    // populate quickLarge and first showcase panel
    const p = await fetchPalette();
    if(p){
      pushPanel(p);
      quickLarge.innerHTML = '';
      p.forEach(a => { quickLarge.appendChild(makeTile(rgbFromArr(a), '100%')); });
    }
    
    // start infinite showcase loop
    startShowcaseLoop();

    // load explore section
    loadExpPalletes(loadMoreBtn);
  } catch(e){ console.warn(e); }
})();


  /* Expose needed functions for inline buttons */
  window.getQuickPallete = getQuickPallete;
  window.createPalette = createPalette;
  window.loadExpPalletes = loadExpPalletes;
  window.downloadPaletteAsJSON = downloadPaletteAsJSON;
  window.downloadPaletteAsASE = downloadPaletteAsASE;
  window.shuffleExplore = shuffleExplore;
  window.navClick = navClick;
  window.mobileNav = mobileNav;
  window.scrollTo = scrollTo;
 
  </script>
</body>
</html>
